---
title: MCP模型上下文协议
published: 2025-09-19
description: 'Model Context Protocol'
image: ''
tags: ['AI', 'MCP']
category: '技术'
draft: false 
lang: ''
---

> 有AI生成内容

## 定义

模型上下文协议 (MCP) 是一个开放的标准化协议，旨在简化大型语言模型 (LLM) 与外部数据源、工具和服务的集成。它由 Anthropic 公司在 2024 年 11 月发起，并逐渐成为 AI 工具交互的新标准。  

传统AI集成需要为每个数据源或工具编写特定的API集成代码，这导致了“M×N”的集成复杂度（M个模型需要连接N个工具），开发维护成本高且难以扩展。MCP 通过提供一个统一的“连接器”解决了这个问题，它将集成复杂性降低到了 N+M，让开发者能专注于业务逻辑而非底层通信。  

## 工作原理

MCP 采用客户端-服务器 (Client-Server) 架构，主要包含三个组件：

- ​**MCP Host (宿主应用)​**​：运行AI应用程序的环境，如 Claude Desktop、VS Code 等 IDE
- ​**MCP Client (客户端)​**​：内嵌在 Host 中的模块，负责与 Server 建立并维护一对一连接，管理通信
- ​**MCP Server (服务器)​**​：轻量级的服务端，负责对接具体的数据源（如数据库、API、文件系统），并通过 MCP 协议暴露三种标准化功能：
    - ​**资源 (Resources)​**​：提供数据访问，如文件、数据库记录或API响应
    - ​**工具 (Tools)​**​：提供函数调用，让AI能执行特定操作，如发送邮件、查询天气
    - ​**提示模板 (Prompts)​**​：预置的指令模板，用于增强互动和指导AI完成任务

其通信通常基于 ​**JSON-RPC 2.0**​ 协议，支持两种传输模式：
- ​**Stdio**​：用于本地进程间通信
- ​**SSE**​：基于HTTP的长连接，适用于云端部署

## MCP协议工作流

1. **初始化连接**​：MCP 主机启动，其内部的 MCP 客户端与一个或多个 MCP 服务器建立连接
2. ​**能力发现**​：客户端向服务器查询其提供的“资源”（数据）、“工具”（函数）和“提示模板”列表
3. ​**决策与请求**​：
    - 用户向主机提出需求（如“总结我昨天的代码提交”）
    - 主机和客户端将请求发送给LLM，LLM判断需要调用哪些工具
    - 客户端向相应的MCP服务器发起工具调用请求
4. ​**执行与返回**​：MCP服务器执行具体操作（如查询Git日志），并将结果通过客户端返回给LLM
5. ​**整合与回复**​：LLM结合工具返回的结果，生成最终回答并呈现给用户

## 特性

- **动态发现**​：MCP 允许 AI 模型动态发现服务器提供的可用工具和资源，无需预先硬编码每个集成的知识，大大提高了灵活性和可扩展性
- ​**双向通信**​：支持持续的实时双向通信（类似于 WebSockets），AI 模型可以动态检索信息并触发操作
- ​**安全机制**​：内置多层安全防护，包括沙盒隔离（限制文件访问目录）、动态鉴权（敏感操作需用户确认）和流量加密（远程通信强制使用 TLS 1.3）

## 例子

假设用户向集成在 IDE 中的 AI 助手（作为 MCP Host）提问：“**北京现在的天气怎么样？​**” 其处理流程如下：

| 步骤             | 参与者                       | 动作                                                                                                              |
| -------------- | ------------------------- | --------------------------------------------------------------------------------------------------------------- |
| ​**2. 能力发现**​  | ​**MCP Client**​ (在Host内) | 向已配置的“天气查询”MCP Server 发送请求，获取其提供的工具列表。                                                                          |
|                | ​**MCP Server**​ (天气服务)   | 返回可用工具列表，例如包含 `get_weather`工具，描述为“查询指定城市的实时天气”，参数为 `city: string`。                                              |
| ​**3. 决策与请求**​ | ​**LLM**​ (如Claude)       | 分析用户问题，匹配到 `get_weather`工具最合适，并生成调用参数 `{"city": "北京"}`。                                                         |
| ​​             | ​**MCP Client**​          | 向天气 MCP Server 发送 JSON-RPC 调用请求：`POST /tools/call`with `{"tool": "get_weather", "parameters": {"city": "北京"}}`。 |
| ​**4. 执行与返回**​ | ​**MCP Server**​          | 接收请求，验证参数，调用其内部或第三方天气 API 获取北京实时天气数据。                                                                           |
|                | ​**MCP Server**​          | 将结构化数据返回给 Client，例如：`{"city": "北京", "weather": "晴", "temperature": "22℃"}`。                                     |
| ​**5. 整合与回复**​ | ​**LLM**​                 | 接收天气数据，将其整合生成自然语言回复：“北京当前天气晴朗，气温22摄氏度。”                                                                         |
|                | ​**MCP Host**​            | 将最终回复呈现给用户。                                                                                                     |
